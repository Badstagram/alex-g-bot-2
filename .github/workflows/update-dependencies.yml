name: Update Dependencies
on:
  workflow_dispatch:
  schedule:
  - cron: 0 21 * * 5

permissions:
  contents: write
  pull-requests: write

jobs:
  update-dependencies:
    if: ${{ github.repository == 'AlexMan123456/alex-g-bot-2' }}
    runs-on: ubuntu-latest
    env:
      HUSKY: 0
    
    strategy:
      matrix:
        node-version: [22.x]

    steps:
    - name: Checkout the repository
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0

    - name: Use Node.js
      uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903 # v6.0.0
      with:
        node-version: 22

    - name: Setup GitHub user
      run: |
        git config --global user.name "AlexUpBot"
        git config --global user.email "alexupbot@bot.com"

    - name: Use latest PNPM version
      run: corepack enable && corepack prepare pnpm@latest --activate

    - name: Install dependencies
      run: pnpm install

    - name: Update JavaScript dependencies
      run: pnpm update

    - name: Update GitHub Actions
      run: pnpx actions-up -y

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@84ae59a2cdc2258d6fa0732dd66352dddae2a412 # v7.0.9
      with:
        token: ${{ secrets.PAT_GITHUB }}
        branch: alex-up-bot/update-dependencies
        base: main
        commit-message: Update dependencies
        title: "Update dependencies"
